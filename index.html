<!DOCTYPE html>

  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/ >
    <title>Australian Open over the years</title>

    <!-- Google fonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

    <!-- D3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    
    <style>
      p {
        font-weight: 600;
        font-size: 16px;
      }
      body {
        font-family: 'Raleway', sans-serif;
        font-size: 11px;
        font-weight: 700;
        fill: #242424;
        text-align: center;
        text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
        cursor: default;
      }
      
      .legend {
        font-family: 'Raleway', sans-serif;
        font-weight: 900;
        fill: #333333;
      }
      
      .tooltip {
        fill: #333333;
      }
    </style>
    <style>

.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 3px;
}

.node text {
  font: 12px sans-serif;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 2px;
}

</style>
<head>
  <font align="center" family='Raleway' size='50' weight='bold'>
    AUSTRALIAN OPEN OVER THE YEARS
  </font>
</head>
<!-- <body style="background-color:#ebf0fa;"> -->
<body>

  <p id="yearbox" name="years">
  
<!--   <button onclick="myFunction()">Reset</button> -->

</p>


<style>
.slidecontainer {
  width: 100%;
}

.slider {
  -webkit-appearance: none;
  width: 50%;
  height: 15px;
  background: #CFCFCF;
  /*background: #4775d1;*/
  outline: none;
  opacity: 1.0;
  -webkit-transition: .2s;
  transition: opacity .2s;
  border-radius: 1000px;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 32px;
  height: 32px;
  /*background: #4CAF50;*/
  /*background: #2e5cb8;*/
  background: url('tennisball.png');
  cursor: pointer;
  border-color: green;
}

.slider::-moz-range-thumb {
  width: 25px;
  height: 25px;
  background: #4CAF50;
  cursor: pointer;
}
</style>


<div class="slider-container">
<input type="range" min="2004" max="2014" value="2004" class="slider" id="myRange">
</div>


<div class="buffer1"></div>

<div class="graphChart"></div>

<!-- <div class="buffer"></div> -->

<div class="radarChart"></div>

<!-- load the d3.js library -->	
<script type="text/javascript" src="imported.json"></script>


<script type="text/javascript" src="data.json"></script>
<!-- <script type="text/javascript" src="y2005array.json"></script>
<script type="text/javascript" src="y2005array.json"></script>
<script type="text/javascript" src="y2005array.json"></script>
<script type="text/javascript" src="y2005array.json"></script>
<script type="text/javascript" src="y2005array.json"></script>
<script type="text/javascript" src="y2005array.json"></script>
<script type="text/javascript" src="y2005array.json"></script>
<script type="text/javascript" src="y2005array.json"></script>
<script type="text/javascript" src="y2005array.json"></script>
<script type="text/javascript" src="y2005array.json"></script>
 -->

<script src="radarChart.js"></script> 
<script src="https://d3js.org/d3.v4.min.js"></script>

<script>

// 


function itbegins(d2k){


  // Set the dimensions and margins of the diagram
  var margin = {top: 10, right: 10, bottom: 10, left: 10},
      width = 1200 - margin.left - margin.right,
      height = 43 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  // appends a 'group' element to 'svg'
  // moves the 'group' element to the top left margin
  var svg3 = d3.select(".buffer1").append("svg")
      .attr("class","buffspace")
      .attr("width", width + margin.right + margin.left)
      .attr("height", height + margin.top + margin.bottom)



  margin = {top: 20, right: 90, bottom: 20, left: 130},
      width = 1200 - margin.left - margin.right,
      height = 323 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  // appends a 'group' element to 'svg'
  // moves the 'group' element to the top left margin
  var svg = d3.select(".graphChart").append("svg")
      .attr("class","nodes.graphChart")
      .attr("width", width + margin.right + margin.left)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate("
            + margin.left + "," + margin.top + ")");
  // d3.select("svg").remove();

  console.log("ok");
    var dupli = [];
    var d2 = {};
    var d2vals1 = {};
    var d2vals2 = {};
    var dv = [];
    var dt1 = [];
    var dt2 = [];

    for(i=0;i<d2k.length;i++){
    d2 = {};
    dv = [];
    dvals1 = [];
    dvals2 = [];
    d2["round"]=d2k[i]["round"];
    d2["year"]=d2k[i]["year"];
    d2["player1"]=d2k[i]["player1"];
    d2["player2"]=d2k[i]["player2"];
    
    dt1 = {};
    dt2 = {};
    dt1["axis"]="firstServe";
    dt1["value"]=d2k[i]["firstServe1"];
    dvals1.push(dt1);
    dt2["axis"]="firstServe";
    dt2["value"]=d2k[i]["firstServe2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="ace";
    dt1["value"]=d2k[i]["aces1"];
    dvals1.push(dt1);
    dt2["axis"]="ace";
    dt2["value"]=d2k[i]["aces2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="firstPointWon";
    dt1["value"]=d2k[i]["firstPointWon1"];
    dvals1.push(dt1);
    dt2["axis"]="firstPointWon";
    dt2["value"]=d2k[i]["firstPointWon2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="secPointWon";
    dt1["value"]=d2k[i]["secPointWon1"];
    dvals1.push(dt1);
    dt2["axis"]="secPointWon";
    dt2["value"]=d2k[i]["secPointWon2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="break";
    dt1["value"]=d2k[i]["break1"];
    dvals1.push(dt1);
    dt2["axis"]="break";
    dt2["value"]=d2k[i]["breaks2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="return";
    dt1["value"]=d2k[i]["return1"];
    dvals1.push(dt1);
    dt2["axis"]="return";
    dt2["value"]=d2k[i]["return2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="net";
    dt1["value"]=d2k[i]["nets1"];
    dvals1.push(dt1);
    dt2["axis"]="net";
    dt2["value"]=d2k[i]["net2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="total";
    dt1["value"]=d2k[i]["totals1"];
    dvals1.push(dt1);
    dt2["axis"]="total";
    dt2["value"]=d2k[i]["totals2"];
    dvals2.push(dt2);

    dv.push(dvals1,dvals2);
    d2["vals"]=dv;
    dupli.push(d2);
    }

    console.log(dupli.length);


    var ddt = {"Final":[],"semi":[],"quarter":[],"Fourth":[],"Third":[],"Second":[],"First":[]};

    var kkeys = ["Final","semi","quarter","Fourth","Third","Second","First"];

    ddt["Final"].push(dupli[0]);


    for(kk=1;kk<kkeys.length;kk++){  

    for(i=0;i<ddt[kkeys[kk-1]].length;i++){
    for(j=(2**kk)-1;j<2**(kk+1)-1;j++){
    if(dupli[j]["player1"]==ddt[kkeys[kk-1]][i]["player1"]){
    ddt[kkeys[kk]].push(dupli[j]);
    break;
    }
    }
    for(j=(2**kk)-1;j<2**(kk+1)-1;j++){
    if(dupli[j]["player1"]==ddt[kkeys[kk-1]][i]["player2"]){
    ddt[kkeys[kk]].push(dupli[j]);
    break;
    }
    }
    }
  }



  // 


  // BELOW PART TIL PPP}

  // var processed_data = [];
  // var ip = dta;

  console.log(ddt["Fourth"].length);

  var rang = d3.scale.ordinal().range(["green","red"]);
  var fin = 0,
      sem = 0,
      qua = 0,
      fou = 0,
      thi = 0,
      sec = 0,
      fir =0;
        

  // var margin = {top: 100, right: 100, bottom: 100, left: 100},
  //       width = Math.min(700, window.innerWidth - 10) - margin.left - margin.right,
  //       height = Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);


// margin = {top: 10, right: 10, bottom: 10, left: 10},
//       width = 1200 - margin.left - margin.right,
//       // height = 20 - margin.top - margin.bottom;
//       height = 0;

//   // append the svg object to the body of the page
//   // appends a 'group' element to 'svg'
//   // moves the 'group' element to the top left margin
//   var svg2 = d3.select(".buffer").append("svg")
//       .attr("class","buffspace")
//       .attr("width", width + margin.right + margin.left)
//       .attr("height", height + margin.top + margin.bottom)



margin = {top: 20, right: 90, bottom: 30, left: 110},
      width = 1100 - margin.left - margin.right,
      height = 300 - margin.top - margin.bottom;

  var radarChartOptions = {
    w: width,
    h: height,
    margin: margin,
    maxValue: 1.0,
    levels: 5,
    roundStrokes: true,
    color: rang
  };

  // for (i=0;i<ip.length;i++){

  //   tempData = [];
  //   jb = ip[i];
  //   for (key in jb){
  //     temp = {};
  //     temp['axis'] = key;
  //     temp['value'] = jb[key];
  //     tempData.push(temp);
  //   }
  //   processed_data.push(tempData);

  // }


  // PPPPPPPPPPPPPPPPPPPP

  // var processed_data = ddt["Final"][0]["vals"];
  var processed_data = ddt;

  var treeData =
        {
          "name": ddt["Final"][fin++]["player1"],
          "children": [
            { 
              "name": ddt["semi"][sem++]["player1"],
              "children": [
                { "name": ddt["quarter"][qua++]["player1"],
                "children": [
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                    ]
                },
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                  ]
            }
                ] },
                { "name": ddt["quarter"][qua++]["player1"],
                "children": [
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                    ]
                },
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                  ]
            }
                ] }
              ]
            },
            { 
              "name": ddt["semi"][sem++]["player1"],
              "children": [
                { "name": ddt["quarter"][qua++]["player1"],
                "children": [
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                    ]
                },
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                  ]
            }
                ] },
                { "name": ddt["quarter"][qua++]["player1"],
                "children": [
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                    ]
                },
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                  ]
            }
                ] }
              ]
            }
          ]
        };

  var i = 0,
      duration = 750,
      root;

  // declares a tree layout and assigns the size
  var treemap = d3.tree().size([height, width]);

  // Assigns parent, children, height, depth
  root = d3.hierarchy(treeData, function(d) { return d.children; });
  root.x0 = height / 2;
  root.y0 = 0;

  // Collapse after the second level
  // root.children.forEach(collapse);

  root.children.forEach(collapse);
  console.log("second")

  update(root);

  console.log("third-late");
// RadarChart(".radarChart", processed_data["Final"][0]["vals"], radarChartOptions);

// Collapse the node and all it's children
function collapse(d) {
  if(d.children) {
    d._children = d.children
    d._children.forEach(collapse)
    d.children = null
  }
}

function update(source) {

  // Assigns the x and y position for the nodes
  var treeData = treemap(root);

  // Compute the new tree layout.
  var nodes = treeData.descendants(),
      links = treeData.descendants().slice(1);

  // Normalize for fixed-depth.
  nodes.forEach(function(d){ d.y = d.depth * 180});

  // ****************** Nodes section ***************************

  // Update the nodes...
  var node = svg.selectAll('g.node')
      .data(nodes, function(d) {return d.id || (d.id = ++i); });

  // Enter any new modes at the parent's previous position.
  var nodeEnter = node.enter().append('g')
      .attr('class', 'node')
      .attr("transform", function(d) {
        return "translate(" + source.y0 + "," + source.x0 + ")";
    })
    .on('click', click);

  // Add Circle for the nodes
  nodeEnter.append('circle')
      .attr('class', 'node')
      .attr('r', 1e-6)
      .style("fill", function(d) {
          return d._children ? "#ffd27f" : "lightgreen";
      });

  // Add labels for the nodes
  nodeEnter.append('text')
      .attr("dy", ".35em")
      .attr("x", function(d) {
          return d.children || d._children ? -13 : 13;
      })
      .attr("text-anchor", function(d) {
          return d.children || d._children ? "end" : "start";
      })
      .text(function(d) { return d.data.name; })
      .style('font-family','Raleway')
      .style('font-weight',900);

  // UPDATE
  var nodeUpdate = nodeEnter.merge(node);

  // Transition to the proper position for the node
  nodeUpdate.transition()
    .duration(duration)
    .attr("transform", function(d) { 
        return "translate(" + d.y + "," + d.x + ")";
     });

  // Update the node attributes and style
  nodeUpdate.select('circle.node')
    .attr('r', 8)
    .style("fill", function(d) {
        return d._children ? "#99b3e6" : "#24478f";
    })
    .attr('cursor', 'pointer')
    .style('stroke-width',0);


  // Remove any exiting nodes
  var nodeExit = node.exit().transition()
      .duration(duration)
      .attr("transform", function(d) {
          return "translate(" + source.y + "," + source.x + ")";
      })
      .remove();

  // On exit reduce the node circles size to 0
  nodeExit.select('circle')
    .attr('r', 1e-6);

  // On exit reduce the opacity of text labels
  nodeExit.select('text')
    .style('fill-opacity', 1e-6);

  // ****************** links section ***************************

  // Update the links...
  var link = svg.selectAll('path.link')
      .data(links, function(d) { return d.id; });

  // Enter any new links at the parent's previous position.
  var linkEnter = link.enter().insert('path', "g")
      .attr("class", "link")
      .attr('d', function(d){
        var o = {x: source.x0, y: source.y0}
        return diagonal(o, o)
      });

  // UPDATE
  var linkUpdate = linkEnter.merge(link);

  // Transition back to the parent element position
  linkUpdate.transition()
      .duration(duration)
      .attr('d', function(d){ return diagonal(d, d.parent) });

  // Remove any exiting links
  var linkExit = link.exit().transition()
      .duration(duration)
      .attr('d', function(d) {
        var o = {x: source.x, y: source.y}
        return diagonal(o, o)
      })
      .remove();

  // Store the old positions for transition.
  nodes.forEach(function(d){
    d.x0 = d.x;
    d.y0 = d.y;
  });

  // Creates a curved (diagonal) path from parent to the child nodes
  function diagonal(s, d) {

    path = `M ${s.y} ${s.x}
            C ${(s.y + d.y) / 2} ${s.x},
              ${(s.y + d.y) / 2} ${d.x},
              ${d.y} ${d.x}`

    return path
  }

  // Toggle children on click.
  function click(d) {
    // d3.select("svg.nodes").remove();
    if (d.children) {
        d._children = d.children;
        d.children = null;
      } else {
        d.children = d._children;
        d._children = null;
      }

    console.log("d._children",d._children);
    console.log("descendants",d.depth);
    update(d);

    // console.log(processed_data.length);
    // document.getElementById("demo").innerHTML = processed_data.length;

    // match_layers = 5;

    // if(d.children){
    //   match_layers-=1;
    //   if(d.children.children)
    //   {
    //     match_layers-=1;
    //     if(d.children.children.children){
    //       match_layers-=1;
    //       if(d.children.children.children.children) {
    //         match_layers-=1;
    //         if(d.children.children.children.children.children){
    //           match_layers-=1;
    //         }
    //       }
    //     }
    //   }
    // }

    // console.log("layer number",match_layers);

    retdepth = d.depth;
    var dname;

    if(d._children==null || retdepth==0){
      dname = d["data"]["name"];
    }
    else{
      dname = d["parent"]["data"]["name"]
      retdepth = retdepth - 1;
    }

    for(ij=0;ij<processed_data[kkeys[retdepth]].length;ij++){
      if(processed_data[kkeys[retdepth]][ij]["player1"]==dname){
        break;
      }
    }

    
    console.log("match-level", kkeys[retdepth]);
    // console.log("Name of node", dname);
    console.log("Name of node", d);
    console.log("dataaaa", processed_data);
    
    
    RadarChart(".radarChart", processed_data[kkeys[retdepth]][ij]["vals"], radarChartOptions);
   
    console.log("Values",processed_data[kkeys[retdepth]][ij]["vals"]);

  }
  }
  function initchart(){
      RadarChart(".radarChart", processed_data["Final"][0]["vals"], radarChartOptions);}

  initchart();
}
console.log("first");
itbegins(dta["2004"]);

</script>

    
    <script>
      

      function myFunction(yr){
      d3.select(".radarChart").select("svg").remove();
      d3.select(".graphChart").select("svg").remove();
      // d3.select(".buffer").select("svg").remove();
      d3.select(".buffer1").select("svg").remove();
      itbegins(dta[yr]);
      }

      var slider = document.getElementById("myRange");
      var output = document.getElementById("yearbox");
      output.innerHTML = slider.value; // Display the default slider value

      slider.oninput = function() {
        output.innerHTML = this.value;
        yy = this.value
        myFunction(yy);
      }

      /* Radar chart design created by Nadieh Bremer - VisualCinnamon.com */
      
      ////////////////////////////////////////////////////////////// 
      //////////////////////// Set-Up ////////////////////////////// 
      ////////////////////////////////////////////////////////////// 

          
      ////////////////////////////////////////////////////////////// 
      ////////////////////////// Data ////////////////////////////// 
      ////////////////////////////////////////////////////////////// 

      // var processed_data = [
      //       [//iPhone
      //       {axis:"Battery Life",value:0.22},
      //       {axis:"Brand",value:0.28},
      //       {axis:"Contract Cost",value:0.29},
      //       {axis:"Design And Quality",value:0.17},
      //       {axis:"Have Internet Connectivity",value:0.22},
      //       {axis:"Large Screen",value:0.02},
      //       {axis:"Price Of Device",value:0.21},
      //       {axis:"To Be A Smartphone",value:0.50}      
      //       ],[//Samsung
      //       {axis:"Battery Life",value:0.27},
      //       {axis:"Brand",value:0.16},
      //       {axis:"Contract Cost",value:0.35},
      //       {axis:"Design And Quality",value:0.13},
      //       {axis:"Have Internet Connectivity",value:0.20},
      //       {axis:"Large Screen",value:0.13},
      //       {axis:"Price Of Device",value:0.35},
      //       {axis:"To Be A Smartphone",value:0.38}
      //       ]
      //     ];
      ////////////////////////////////////////////////////////////// 
      //////////////////// Draw the Chart ////////////////////////// 
      //////////////////////////////////////////////////////////////
     
      //Call function to draw the Radar chart
      // RadarChart(".radarChart", processed_data, radarChartOptions);
    </script>


</body>